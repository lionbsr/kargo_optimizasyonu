<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Kargo GÃ¶nder</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
body {
    font-family: "Segoe UI", Arial, sans-serif;
    background: linear-gradient(135deg, #e9efff, #f7f9fc);
    margin: 0;
    padding: 0;
}

.container {
    width: 540px;
    margin: 40px auto;
    background: #fff;
    padding: 25px;
    border-radius: 14px;
    box-shadow: 0 12px 30px rgba(0,0,0,0.12);
}

h2 {
    text-align: center;
    margin-bottom: 20px;
}

label {
    font-weight: 600;
    margin-top: 12px;
    display: block;
}

select, input {
    width: 100%;
    padding: 11px;
    margin-top: 6px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 14px;
}

input:focus, select:focus {
    outline: none;
    border-color: #4a6cff;
}

button {
    width: 100%;
    padding: 12px;
    margin-top: 14px;
    border: none;
    border-radius: 8px;
    font-size: 15px;
    cursor: pointer;
}

.add-btn {
    background: #4a6cff;
    color: white;
}

.send-btn {
    background: #2ecc71;
    color: white;
}

.info {
    background: #eef3ff;
    padding: 10px;
    border-radius: 8px;
    margin-top: 12px;
    font-size: 13px;
}

#map {
    height: 360px;
    margin-top: 18px;
    border-radius: 10px;
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
    font-size: 14px;
}

th {
    background: #f1f3f7;
}

th, td {
    padding: 8px;
    border: 1px solid #ddd;
    text-align: center;
}
</style>
</head>

<body>

<div class="container">
<h2>ğŸ“¦ Kargo Ekle</h2>

<label>ğŸ“ Hedef Ä°stasyon</label>
<select id="station">
{% for s in stations %}
<option value="{{ s.id }}" data-lat="{{ s.lat }}" data-lon="{{ s.lon }}">
{{ s.name }}
</option>
{% endfor %}
</select>

<label>âš–ï¸ AÄŸÄ±rlÄ±k (kg)</label>
<input type="number" id="weight" placeholder="Ã–rn: 120" min="1">

<button class="add-btn" onclick="addCargo()">â• Kargo Ekle</button>

<div class="info">
Birden fazla kargo ekleyebilirsiniz. DaÄŸÄ±tÄ±m iÅŸlemi en son baÅŸlatÄ±lÄ±r.
</div>

<div id="map"></div>

<button class="send-btn" onclick="sendCargos()">ğŸšš DaÄŸÄ±tÄ±ma GÃ¶nder</button>

<h3>ğŸ“‹ GÃ¶nderilen Kargolar</h3>
<table>
<thead>
<tr>
<th>#</th>
<th>Ä°lÃ§e</th>
<th>AÄŸÄ±rlÄ±k (kg)</th>
</tr>
</thead>
<tbody id="cargoTable"></tbody>
</table>

</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
let cargos = [];

const map = L.map("map").setView([40.766, 29.916], 10);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);

function addCargo() {
    const station = document.getElementById("station");
    const weight = parseFloat(document.getElementById("weight").value);

    if (isNaN(weight) || weight <= 0) {
        alert("GeÃ§erli bir aÄŸÄ±rlÄ±k giriniz");
        return;
    }

    const opt = station.selectedOptions[0];

    const cargo = {
        station_id: station.value,
        name: opt.text,
        lat: opt.dataset.lat,
        lon: opt.dataset.lon,
        weight: weight
    };

    cargos.push(cargo);

    L.marker([cargo.lat, cargo.lon])
        .addTo(map)
        .bindPopup(`<b>${cargo.name}</b><br>${cargo.weight} kg`);

    document.getElementById("weight").value = "";
}

function sendCargos() {
    if (cargos.length === 0) {
        alert("En az bir kargo ekleyin");
        return;
    }

    fetch("/add_cargo", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(cargos)
    })
    .then(res => res.json())
    .then(() => {
        renderTable();
        alert("âœ… Kargolar daÄŸÄ±tÄ±ma gÃ¶nderildi");
        cargos = [];
    });
}

function renderTable() {
    const table = document.getElementById("cargoTable");
    table.innerHTML = "";

    cargos.forEach((c, i) => {
        table.innerHTML += `
            <tr>
                <td>${i+1}</td>
                <td>${c.name}</td>
                <td>${c.weight}</td>
            </tr>
        `;
    });
}
</script>

</body>
</html>
